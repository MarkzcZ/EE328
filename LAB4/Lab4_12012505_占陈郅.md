# Lab4_12012505_占陈郅

### Introduction

The purpose of this lab are that

- Learn the windowing effect for short-time  speech analysis 
- Learn to analyse speech signal with shorttime energy, magnitude and zero-crossing



### Lab results and Analysis

#### Problem 1

| window                                                  | window DTFT spectrum in dB                              |
| ------------------------------------------------------- | ------------------------------------------------------- |
| ![1](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\1.png) | ![2](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\2.png) |

After comparing the peak sidelobe ripple in dB of the five windows, the rectangular window has the narrowest lobe, while the blackman window has the widest lobe.

Code

```matlab
figure()
subplot(5,1,1);plot([ones(1,21),0,0,0,0]);title('rectangular window');axis([1, 25,-0.2,1.2]);
subplot(5,1,2);plot(triang(21));title('triangular window');axis([1, 25,-0.2,1.2]);
subplot(5,1,4);plot(hamming(21));title('hamming window');axis([1, 25,-0.2,1.2]);
subplot(5,1,3);plot(hann(21));title('hanning window');axis([1, 25,-0.2,1.2]);
subplot(5,1,5);plot(blackman(21));title('balckman window');axis([1, 25,-0.2,1.2]);

window1 = ones(21);
window2 = triang(21);
window3 = hann(21);
window4 = hamming(21);
window5 = blackman(21);
[H1, w1] = DTFT(window1,512);
[H2, w2] = DTFT(window2,512);
[H3, w3] = DTFT(window3,512);
[H4, w4] = DTFT(window4,512);
[H5, w5] = DTFT(window5,512);
H1 = 20*log10(abs(H1));
H2 = 20*log10(abs(H2));
H3 = 20*log10(abs(H3));
H4 = 20*log10(abs(H4));
H5 = 20*log10(abs(H5));
figure()
subplot(5,1,1);plot(w1,H1);title('rectangular window spectrum(dB)');axis([0,3.14,-50,50]);
subplot(5,1,2);plot(w2,H2);title('triangular window spectrum(dB)');axis([0,3.14,-50,50]);
subplot(5,1,3);plot(w3,H3);title('hanning window spectrum(dB)');axis([0,3.14,-50,50]);
subplot(5,1,4);plot(w4,H4);title('hamming window spectrum(dB)');axis([0,3.14,-50,50]);
subplot(5,1,5);plot(w5,H5);title('blackman window spectrum(dB)');axis([0,3.14,-50,50]);

```



#### Problem 2

| rectangular R=10 L=21                                        | hamming R=10 L=21                                            |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![R_10_21](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\R_10_21.png) | ![H_10_21](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\H_10_21.png) |

| rectangular R=2 L=21                                         | rectangular R=10 L=101                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![R_2_21](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\R_2_21.png) | ![R_10_101](C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\R_10_101.png) |

From the results, there is little difference between the rectangular window and the hamming window. When the window shift R is adjusted from 10 to 2, the span of the horizontal coordinate becomes larger which means the length of the signal becomes longer because the sampling rate is larger than when R=10. And when comparing the window size, we can see that when L increases to 101, the signal waveform is more converged and clearer.

Code

```matlab
function [  ] = analyze( input_file, window_type, window_shift, window_size)

signal = audioread(input_file);
R = window_shift;
L = window_size;
figure;
subplot(4,1,1);plot(signal);title('waveform');xlim([0,length(signal)]);

if window_type == 'R'
    window = ones(1,L)';
elseif window_type == 'H'
    window = hamming(L);
end

% short time energy
window_e = window.^2;
stenergy = zeros(1, round((length(signal)-L)/R));
for i = 1:length(stenergy)
    map_i = (i-1)*R+1;% map_i is n hat, beginning of each small piece 
    stenergy(i) = sum((signal(map_i:map_i+L-1).^2).*window_e);
end
subplot(4,1,2);plot(stenergy);title('short-time energy');xlim([0,length(stenergy)]);

% short time magnitude, almost the same with stenergy
stmagnitude = zeros(1, round((length(signal)-L)/R));
for i = 1:length(stmagnitude)
    map_i = (i-1)*R+1;
    stmagnitude(i) = sum(abs(signal(map_i:map_i+L-1)).*window);
end
subplot(4,1,3);plot(stmagnitude);title('short-time magnitude');xlim([0,length(stmagnitude)]);

% short time zero-crossing rate, using the object to calculate
stzeroc = zeros(1, round((length(signal)-L)/R));
Hzerocross = dsp.ZeroCrossingDetector;
for i = 1:length(stzeroc)
    map_i = (i-1)*R+1;
    stzeroc(i) = step(Hzerocross,signal(map_i:map_i+L-1));
end
subplot(4,1,4);plot(stzeroc);title('short-time zero-crossing');xlim([0,length(stzeroc)]);

end
```



#### Problem 3

In this problem we use hamming window.

<img src="C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\common1.png" alt="common1" style="zoom:75%;" />

<img src="C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\common2.png" alt="common2" style="zoom:75%;" />

<img src="C:\Users\M__zzZ\Documents\MATLAB\EE328\LAB4\common3.png" alt="common3" style="zoom:75%;" />

It can be seen that the window length L can clearly change the result when L increases, which corresponds to a low-pass filter with a smaller cut-off frequency, meaning that there will be less high-frequency detail and the image will be more converged and clear.

Therefore, when a clear envelope image is needed, the larger L is better, and when high frequency details of the signal are needed, the lower L is better.

Code

```matlab
[signal, Fs] = audioread('test_16k.wav');
R = 5; % window_shift;
L = [51, 101, 201, 401]; %duration;
figure;

% short-time energy
figure()
for j = 1:4
    stenergy = zeros(1, round((length(signal)-L(j))/R));
    window = hamming(L(j));
    window_e = window.^2;
    for i = 1:length(stenergy)
        map_i = (i-1)*R+1;
        stenergy(i) = sum((signal(map_i:(map_i+L(j)-1)).^2).*window_e);
    end
    plot(stenergy);title(sprintf('short-time energy'));xlim([0,length(stenergy)]);
    hold on
end
legend('L = 51','L = 101','L = 201','L = 401')
hold off
% short time magnitude
figure()
for j = 1:4
    stmagnitude = zeros(1, round((length(signal)-L(j))/R));
    window = hamming(L(j));
    for i = 1:length(stmagnitude)
        map_i = (i-1)*R+1;
        stmagnitude(i) = sum(abs(signal(map_i:map_i+L(j)-1)).*window);
    end
    plot(stmagnitude);title(sprintf('short-time magnitude'));xlim([0,length(stmagnitude)]);
    hold on
end
legend('L = 51','L = 101','L = 201','L = 401')
hold off
% short time zero crossing
figure()
for j = 1:4
    stzeroc = zeros(1, round((length(signal)-L(j))/R));
    Hzerocross = dsp.ZeroCrossingDetector;
    for i = 1:length(stzeroc)
        map_i = (i-1)*R+1;
        stzeroc(i) = step(Hzerocross,signal(map_i:map_i+L(j)-1));
    end
    plot(stzeroc);title(sprintf('short-time zero-crossing'));xlim([0,length(stzeroc)]);
    hold on
end
legend('L = 51','L = 101','L = 201','L = 401')
hold off
```



### Summary

- In general, the choice of the first side valve attenuation is large, the peak attenuation of the side valve fast window function is conducive to alleviate the truncation process generated by the spectral leakage problem. But with these two characteristics of the window function, the main flap width is larger, the corresponding will bring some side effects, the application needs to be selected according to the specific circumstances of the compromise.
- According to the impact of the window function on data processing, the ideal window function can be selected with reference to the following principles.
  - The main flap of the window function spectrum should be as narrow as possible to improve the frequency domain resolution and reduce leakage when the spectrum is estimated.
  - minimize the relative magnitude of the maximum side flap of the window function spectrum, so that the height of the side flap decays as soon as possible with the frequency.
  - If the above two can not be met at the same time, it is often to increase the width of the main flap in exchange for the suppression of the side flap.
- In short, in the application of the window function, in addition to consider the window function spectrum itself, in addition to the characteristics of the signal should be fully considered by the characteristics of the analysis and specific processing requirements.
